<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <meta http-equiv="X-UA-Compatible" content="ie=edge" />
   <!-- Links to Bootstrap and JS, Popper.js, and jQuery -->
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
   <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"></script>
   <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"></script>
   <!-- My own syle sheet -->
   <link rel="stylesheet" href="public\css\latest.css">
   <link rel="stylesheet" href="/style.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
   <link href="https://fonts.googleapis.com/css?family=Asap" rel="stylesheet">
   <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

   <title>Home Page</title>
</head>
<!-- The start of the nav-bar -->
<header> <% include partials/header %> </header>
<!-- <form class="ajax_caller" onsubmit="do_ajax_call()">  <input type="submit" value="Submit">
</form> -->
<div>
   <div class="jumbotron">
      <div class="row w-100">
         <div class="col-md-3">
            <div class="card border-info mx-sm-1 p-3">
               <div class="card border-info shadow text-info p-3 my-card"><span class="fa fa-plus"
                     aria-hidden="true"></span></div>
               <div class="text-info text-center mt-3">
                  <h4>Total Confirmed</h4>
               </div>
               <div class="text-info text-center mt-2">
                  <h1><%= data.totalConfirmed %></h1>
               </div>
            </div>
         </div>
         <div class="col-md-3">
            <div class="card border-success mx-sm-1 p-3">
               <div class="card border-success shadow text-success p-3 my-card"><span class="fa fa-heart"
                     aria-hidden="true"></span></div>
               <div class="text-success text-center mt-3">
                  <h4>Total Recovered</h4>
               </div>
               <div class="text-success text-center mt-2">
                  <h1><%= data.totalRecovered %></h1>
               </div>
            </div>
         </div>
         <div class="col-md-3">
            <div class="card border-danger mx-sm-1 p-3">
               <div class="card border-danger shadow text-danger p-3 my-card"><span class="fa fa-ambulance"
                     aria-hidden="true"></span></div>
               <div class="text-danger text-center mt-3">
                  <h4>Total Did Dead</h4>
               </div>
               <div class="text-danger text-center mt-2">
                  <h1><%= data.totalDeceased %></h1>
               </div>
            </div>
         </div>
         <div class="col-md-3">
            <div class="card border-warning mx-sm-1 p-3">
               <div class="card border-warning shadow text-warning p-3 my-card"><span class="fa fa-heartbeat"
                     aria-hidden="true"></span></div>
               <div class="text-warning text-center mt-3">
                  <h4>Total Tested</h4>
               </div>
               <div class="text-warning text-center mt-2">
                  <h1><%= data.totalTested %></h1>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>

<div class="">
   <div class="row">
      <div class="col-sm tweet-box" style="background-color: cyan;">
         <div class="tweet-wrap"  style="margin: 10%;">
            <div class="tweet-header">
               <img id="asp-user-image" src="https://pbs.twimg.com/profile_images/1102622116770394112/-VL87yOl_400x400.png"
                  alt="" class="avator">
               <div class="tweet-header-info">
                  <p><b id="asp-userActualName">NYC Alt Side Parking</b> <span id="asp-user-name">@NYCASP</span></p>
                  <div class="tweet-handle-name">
                     <!-- <p id="user-description">Using twitter stream API</p> -->
                  </div>
                  <!-- <span>. Jun 27</span> -->
                  <p id="asp-content"><%= asp.content %></p>

               </div>

            </div>
            <div class="tweet-img-wrap">
               <img id="asp-image" src="" alt="" class="tweet-img">
            </div>
            <div class="tweet-info-counts">

               <div class="comments">

                  <svg class="feather feather-message-circle sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg"
                     width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                     <path
                        d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                     </path>
                  </svg>
                  <div class="asp-comment-count">33</div>
               </div>

               <div class="retweets">
                  <svg class="feather feather-repeat sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg" width="20"
                     height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                     <polyline points="17 1 21 5 17 9"></polyline>
                     <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                     <polyline points="7 23 3 19 7 15"></polyline>
                     <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                  </svg>
                  <div class="asp-retweet-count">397</div>
               </div>

               <div class="likes">
                  <svg class="feather feather-heart sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg" width="20"
                     height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                     <path
                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                     </path>
                  </svg>
                  <div class="asp-likes-count">
                     2.6k
                  </div>
               </div>


            </div>
         </div>
      </div>
      <div class="col-sm tweet-box" style="background-color: yellowgreen;">
         <div class="tweet-wrap"  style="margin: 10%;">
            <div class="tweet-header">
               <img id="trump-user-image" src="https://pbs.twimg.com/profile_images/874276197357596672/kUuht00m_400x400.jpg"
                  alt="" class="avator">
               <div class="tweet-header-info">
                  <p><b id="trump-userActualName">Donald J. Trump</b> <span id="trump-user-name">@realDonaldTrump</span></p>
                  <div class="tweet-handle-name">
                     <!-- <p id="user-description">Using twitter stream API</p> -->
                  </div>
                  <!-- <span>. Jun 27</span> -->
                  <p id="trump-content"><%= trump[3].content %></p>
               </div>

            </div>
            <div class="tweet-img-wrap">
               <img id="trump-image" src="" alt="" class="tweet-img">
            </div>
            <div class="tweet-info-counts">

               <div class="comments">

                  <svg class="feather feather-message-circle sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg"
                     width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                     <path
                        d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                     </path>
                  </svg>
                  <div class="trump-comment-count">33</div>
               </div>

               <div class="retweets">
                  <svg class="feather feather-repeat sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg" width="20"
                     height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                     <polyline points="17 1 21 5 17 9"></polyline>
                     <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                     <polyline points="7 23 3 19 7 15"></polyline>
                     <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                  </svg>
                  <div class="trump-retweet-count">397</div>
               </div>

               <div class="likes">
                  <svg class="feather feather-heart sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg" width="20"
                     height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                     <path
                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                     </path>
                  </svg>
                  <div class="trump-likes-count">
                     2.6k
                  </div>
               </div>


            </div>
         </div>
      </div>
      <div class="col-sm tweet-box" style="background-color:darkcyan;">
         <div class="tweet-wrap">
            <div class="tweet-header">
               <img id="user-image" src=""
                  alt="" class="avator">
               <div class="tweet-header-info">
                  <p><b id="userActualName"></b> <span id="user-name"></span></p>
                  <div class="tweet-handle-name">
                     <!-- <p id="user-description">Using twitter stream API</p> -->
                  </div>
                  <!-- <span>. Jun 27</span> -->
                  <p id="content">ðŸ”¥</p>

               </div>

            </div>
            <div class="tweet-img-wrap">
               <img id="image" src="" alt="" class="tweet-img">
            </div>
            <div class="tweet-info-counts">

               <div class="comments">

                  <svg class="feather feather-message-circle sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg"
                     width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                     <path
                        d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                     </path>
                  </svg>
                  <div class="comment-count">33</div>
               </div>

               <div class="retweets">
                  <svg class="feather feather-repeat sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg" width="20"
                     height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                     <polyline points="17 1 21 5 17 9"></polyline>
                     <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                     <polyline points="7 23 3 19 7 15"></polyline>
                     <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                  </svg>
                  <div class="retweet-count">397</div>
               </div>

               <div class="likes">
                  <svg class="feather feather-heart sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg" width="20"
                     height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                     <path
                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                     </path>
                  </svg>
                  <div class="likes-count">
                     2.6k
                  </div>
               </div>


            </div>
         </div>
      </div>
   </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"
   integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
   var socket = io();
   var tweetArray = [];
   var index = 0;
   socket.on('connect', function (data) {
      console.log('connected');
   })
   socket.on('tweet', function (tweet) {
      console.log(tweet.tweet);
      var tweetbody = {
         'userActualName': tweet.tweet.user.name,
         'text': tweet.tweet.text,
         'userScreenName': "@" + tweet.tweet.user.screen_name,
         'userImage': tweet.tweet.user.profile_image_url_https,
         'userDescription': tweet.tweet.user.description,
      }
      try {
         if (tweet.tweet.entities.media[0].media_url_https) {
            tweetbody['image'] = tweet.tweet.entities.media[0].media_url_https;
         }
      } catch (err) { }
      tweetArray.unshift(tweetbody);
   });


   socket.on('allTweet', function (tweet) {
      // console.log(tweet);
      tweetArray = tweet;
      loopArray();
      loopTrump();
   });

   function kFormatter(num) {
      return Math.abs(num) > 999 ? Math.sign(num)*((Math.abs(num)/1000).toFixed(1)) + 'k' : Math.sign(num)*Math.abs(num)
   }

   function randomNumGen(min, max){
      return Math.floor(Math.random() * max) + min;

   }

   function loopTrump(){
      var trumpObj = <%-JSON.stringify(trump)%>;
      let randomNum = Math.floor(Math.random() * trumpObj.length-1) + 0;
      $('#trump-content').html(trumpObj[randomNum].content);

      $('.trump-comment-count').html(kFormatter(randomNumGen(1, 1000000)))
      $('.trump-retweet-count').html(kFormatter(randomNumGen(1, 1000000)))
      $('.trump-likes-count').html(kFormatter(randomNumGen(1, 1000000)))
      
      setTimeout(loopTrump, randomNumGen(5000, 6000))
   }

   
   $('.asp-comment-count').html(kFormatter(randomNumGen(1, 1000000)))
   $('.asp-retweet-count').html(kFormatter(randomNumGen(1, 1000000)))
   $('.asp-likes-count').html(kFormatter(randomNumGen(1, 1000000)))


   function loopArray() {
      let randomTime = Math.floor(Math.random() * 5000) + 6000;
      if (tweetArray.length > index) {
         var currentTweet = tweetArray[index];
         index++;
         $('#userActualName').html(currentTweet.userActualName);
         $('#user-name').html(currentTweet.userScreenName);
         $('#user-description').html(currentTweet.userDescription);
         $('#content').html(currentTweet.text);
         $("#user-image").attr("src", currentTweet.userImage);
         if (currentTweet.image) {
            $("#image").attr("src", currentTweet.image);
            // console.log("hello: ");
         } else {
            $("#image").attr("src", "");         }
      } else {
         index = 0;
      }
      $('.comment-count').html(kFormatter(randomNumGen(1, 1000000)))
      $('.retweet-count').html(kFormatter(randomNumGen(1, 1000000)))
      $('.likes-count').html(kFormatter(randomNumGen(1, 1000000)))

      setTimeout(loopArray, randomNumGen(100,200));
   }

   $(document).on('submit', 'form.ajax_caller', do_ajax_call)

   function do_ajax_call (e) {
      e.preventDefault()
      $.get('/latest', {randomStuff: 'goes here'}, function (res) {
         console.log('callback after your node function is done')
      })
   }
</script>
</body>

</html>